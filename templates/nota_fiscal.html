<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Nota Fiscal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}

.nota {
  max-width: 900px;
  margin: auto;
  background: #fff;
  border: 2px solid #000;
  padding: 20px;
}

.cabecalho {
  display: flex;
  justify-content: space-between;
  border-bottom: 2px solid #000;
  padding-bottom: 10px;
}

.cabecalho .empresa {
  font-size: 14px;
}

.cabecalho .nf {
  text-align: right;
  font-size: 14px;
}

.titulo {
  text-align: center;
  font-weight: bold;
  margin: 15px 0;
  font-size: 18px;
}

.bloco {
  border: 1px solid #000;
  padding: 8px;
  margin-bottom: 8px;
  font-size: 13px;
}

.bloco strong {
  display: block;
  font-size: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th, td {
  border: 1px solid #000;
  padding: 6px;
  text-align: center;
}

th {
  background: #eaeaea;
}

.total {
  text-align: right;
  font-size: 16px;
  font-weight: bold;
  margin-top: 10px;
}

button {
  margin-top: 20px;
  padding: 10px 18px;
  font-size: 16px;
  background: #000;
  color: #fff;
  border: none;
  cursor: pointer;
}

@media print {
  button {
    display: none;
  }
  body {
    background: #fff;
    padding: 0;
  }
}
</style>
</head>

<body>

<div class="nota">

  <!-- CABE√áALHO -->
  <div class="cabecalho">
    <div class="empresa">
      <strong>GIL ELETR√îNICOS</strong><br>
      CNPJ: 00.000.000/0001-00<br>
      Endere√ßo: Rua Exemplo, 123<br>
      Cidade - UF
    </div>

    <div class="nf">
      <strong>NOTA FISCAL</strong><br>
      N¬∫ <span id="numeroNF">000001</span><br>
      Data: <span id="data"></span>
    </div>
  </div>

  <div class="titulo">DOCUMENTO AUXILIAR DE NOTA FISCAL</div>

  <!-- CLIENTE -->
  <div class="bloco">
    <strong>DADOS DO CLIENTE</strong>
    Nome: _________________________________<br>
    CPF/CNPJ: _____________________________
  </div>

  <!-- PRODUTOS -->
  <table>
    <thead>
      <tr>
        <th>Produto</th>
        <th>Categoria</th>
        <th>Pre√ßo (R$)</th>
        <th>Qtd</th>
        <th>Total (R$)</th>
      </tr>
    </thead>
    <tbody id="itens"></tbody>
  </table>

  <div class="total">
    Total da Nota: R$ <span id="totalGeral">0.00</span>
  </div>

  <button onclick="window.print()">üñ®Ô∏è Imprimir Nota Fiscal</button>
</div>

<script>
async function carregarProdutos() {
  const res = await fetch('/api/produtos');
  const produtos = await res.json();

  const tbody = document.getElementById('itens');

  produtos.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.nome}</td>
      <td>${p.categoria}</td>
      <td>${Number(p.preco).toFixed(2)}</td>
      <td>
        <input type="number" min="0" value="0" style="width:60px" onchange="calcular()">
      </td>
      <td class="subtotal">0.00</td>
    `;
    tbody.appendChild(tr);
  });
}

function calcular() {
  let total = 0;
  document.querySelectorAll('#itens tr').forEach(tr => {
    const preco = parseFloat(tr.children[2].innerText);
    const qtd = parseInt(tr.children[3].children[0].value) || 0;
    const subtotal = preco * qtd;
    tr.querySelector('.subtotal').innerText = subtotal.toFixed(2);
    total += subtotal;
  });
  document.getElementById('totalGeral').innerText = total.toFixed(2);
}

document.getElementById('data').innerText =
  new Date().toLocaleDateString('pt-BR');

carregarProdutos();
</script>

</body>
</html>
